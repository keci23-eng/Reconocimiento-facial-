{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Registrar estudiante</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/login.css' %}">
  <link rel="icon" href="{% static 'images/logo.png' %}" type="image/png">
</head>

<body class="app-bg">

  <div class="page-wrap">
    <div class="container app-shell">

      <header class="topbar-pro">
        <div class="topbar-left">
          <div class="app-brand">
            
            <div>
              <div class="brand-title">Registro</div>
              <div class="breadcrumbs">
                <span>Estudiantes</span>
                <span class="crumb-sep">/</span>
                <span class="crumb-active">Cámara</span>
              </div>
            </div>
          </div>

          <div class="topbar-meta">
            <span class="chip chip-live">Cámara activa</span>
            <span class="chip chip-muted">Captura y registro</span>
          </div>
        </div>

        <div class="topbar-actions">
          <a href="/logout/" class="btn btn-outline-danger btn-sm btn-soft">Cerrar sesión</a>
        </div>
      </header>

      <section class="hero-strip">
        <div class="hero-copy">
          <div class="hero-title">Registrar rostro</div>
          <div class="hero-sub">Coloca el rostro centrado y mantente quieto al capturar.</div>
        </div>

        <div class="hero-stats">
          <div class="mini-stat">
            <div class="mini-stat-label">Carrera</div>
            <div class="mini-stat-value">SISTEMAS Y GESTION DE DATA</div>
          </div>
          
        </div>
      </section>

      <main class="app-card app-card-pro">
        <div class="row g-4">

          <div class="col-lg-7">
            <section class="panel panel-pro">
              <div class="panel-head">
                <div>
                  <div class="panel-title">Vista previa</div>
                  <div class="panel-sub">Evita contraluz y mantén el rostro centrado.</div>
                </div>
                
              </div>

              <div class="panel-body">
                <div class="video-shell">
                  <div class="video-topline"></div>
                  <div class="video-wrapper">
                    <video id="video" autoplay muted playsinline></video>
                    <canvas id="overlay"></canvas>
                  </div>
                </div>

                <div class="tips-row">
                  <span class="tip-pill">Buena iluminación</span>
                  <span class="tip-pill">De frente</span>
                  <span class="tip-pill">Sin movimiento</span>
                </div>

                <div class="panel-hint">
                  Mantente quieto 1–2 segundos antes de capturar.
                </div>
              </div>
            </section>
          </div>

          <div class="col-lg-5">
            <section class="panel panel-pro">
              <div class="panel-head">
                <div>
                  <div class="panel-title">Datos</div>
                  <div class="panel-sub">Asegúrate de escribir tu nombre completo.</div>
                </div>
              </div>

              <div class="panel-body">
                <div class="mb-3">
                  <label class="form-label">Nombre completo</label>
                  <input id="nameInput" class="form-control" placeholder="Ej: Juan Pérez" required>
                </div>

                <div class="mb-3">
                  <label class="form-label">Carrera</label>
                  <input id="careerInput" class="form-control" value="SISTEMAS Y GESTION DE DATA" required>
                  <div class="form-text">Solo se permite esta carrera.</div>
                </div>

                <button id="captureRegisterBtn" class="btn btn-primary-custom w-100">
                  Capturar y registrar
                </button>

                

                <div class="note-box mt-3">
                  Si falla, mejora la iluminación y vuelve a intentar.
                </div>
              </div>
            </section>
          </div>

        </div>
      </main>

    </div>
  </div>

  <script src="{% static 'js/register.js' %}"></script>

  <div id="careerModal" class="modal-pro" role="dialog" aria-hidden="true">
    <div class="modal-pro-card" role="document">
      <div class="modal-pro-title">Carrera no permitida</div>
      <div class="modal-pro-text">
        Solo se permite registrar <strong>SISTEMAS Y GESTION DE DATA</strong>.
      </div>
      <div class="modal-pro-actions">
        <button id="careerModalClose" class="btn btn-primary-custom btn-sm">Cerrar</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const video = document.getElementById('video');
      const overlay = document.getElementById('overlay');

      video?.addEventListener('loadedmetadata', () => {
        overlay.width = video.videoWidth || 640;
        overlay.height = video.videoHeight || 480;
      });

      const status = document.getElementById('status');
      const mini = document.getElementById('uiStatusMini');
      if(status && mini){
        const sync = () => mini.textContent = (status.textContent || '').trim() || '—';
        sync();
        new MutationObserver(sync).observe(status, { childList: true, subtree: true });
      }
    });
  </script>

</body>
</html>
